<!doctype html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <title>Paint - Project</title>

    <link rel="icon" type="image/svg+xml" href="../public/icons/Pepe.svg" />
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tahoma:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  </head>

  <body class="bg-white p-4" style="font-family: 'Tahoma', sans-serif; background-image: url('../public/images/background.png');">

    <!-- Base Window Component -->
    <base-window title="Paint - Project">
      
      <!-- Menu Left -->
      <div slot="menu-left">
        <button id="file-btn" class="xp-button">
          File
        </button>
        <button id="draw-params-btn" class="xp-button">
          Draw Parameters
        </button>
        <button id="color-picker-btn" class="xp-button">
          Color Picker
        </button>
        <button id="image-processing-btn" class="xp-button">
          Image Processing
        </button>
        <button id="histogram-btn" class="xp-button">
          Histogram and Binarization
        </button>
        <button id="morphological-btn" class="xp-button">
          Morphological Filters
        </button>
        <button id="green-analysis-btn" class="xp-button">
          Green Area Analysis
        </button>
      </div>

      <!-- Toolbox -->
      <div slot="toolbox" class="bg-[#ECE9D8]">
        <div class="flex flex-col gap-1 p-2">
          
          <button id="tool-select" class="xp-button-tool" title="Select">
            <i class="fas fa-mouse-pointer"></i>
          </button>

          <button id="tool-brush" class="xp-button-tool" title="Brush">
            <i class="fas fa-paint-brush"></i>
          </button>

          <button id="tool-line" class="xp-button-tool" title="Line">
            <i class="fas fa-minus rotate-45 mt-1"></i>
          </button>

          <button id="tool-rectangle" class="xp-button-tool" title="Rectangle">
            <i class="far fa-square"></i>
          </button>

          <button id="tool-circle" class="xp-button-tool" title="Circle">
            <i class="far fa-circle"></i>
          </button>

          <button id="tool-bezier" class="xp-button-tool" title="Bezier Curve">
            <i class="fas fa-bezier-curve"></i>
          </button>

          <button id="tool-polygon" class="xp-button-tool" title="Polygon">
            <i class="fas fa-draw-polygon"></i>
          </button>

          <button id="zoom-btn" class="xp-button-tool" title="Zoom">
            <i class="fas fa-search"></i>
          </button> 

          <button id="tool-rgb-cube" class="xp-button-tool" title="Color Picker">
            <i class="fas fa-cube"></i>
          </button>

        </div>
      </div>

      <!-- Panels -->
      <div slot="panels">
        
        <!-- File Panel -->
        <div id="file-panel" class="hidden bg-[#ECE9D8] border-t border-[#808080] px-2 py-2">
          <div class="flex items-center gap-2 text-xs flex-wrap">
          
            <label class="flex items-center gap-1">
              <span>Select type:</span>
              <select id="param-file-type" class="xp-select">
                <option value="json">Json</option>
                <option value="ppm-p3">PPM-P3</option>
                <option value="ppm-p6">PPM-P6</option>
                <option value="jpeg">JPEG</option>
              </select>
            </label>

            <label id="compression-panel" class="hidden items-center gap-1">
              Compression:
              <input type="range" id="compression-slider" min="0" max="100" value="80" class="xp-slider">
              <span id="compression-value" class="text-xs">80</span>
            </label>

            <button id="save-file-btn" class="xp-button hidden">
              <i class="fas fa-save mr-1"></i>Save Drawing
            </button>
            
            <button id="load-file-btn" class="xp-button hidden">
              <i class="fas fa-folder-open mr-1"></i>Load Drawing
            </button>
            
            <input type="file" id="file-input" accept="" class="hidden">
            
            <button id="close-file-btn" class="xp-button text-red-500 font-bold">
              Close
            </button>
          </div>
        </div>

        <!-- Drawing Parameters Panel -->
        <div id="draw-params-panel" class="hidden bg-[#ECE9D8] border-t border-[#808080] px-2 py-2">
          <div class="flex items-center gap-2 text-xs flex-wrap">
            <label class="flex items-center gap-1">
              <span>Shape:</span>
              <select id="param-shape" class="xp-select">
                <option value="line">Line</option>
                <option value="rectangle">Rectangle</option>
                <option value="circle">Circle</option>
              </select>
            </label>
            
            <label class="flex items-center gap-1">
              <span>X1:</span>
              <input type="number" id="param-x1" placeholder="0" class="xp-input">
            </label>
            
            <label class="flex items-center gap-1">
              <span>Y1:</span>
              <input type="number" id="param-y1" placeholder="0" class="xp-input">
            </label>
            
            <label class="flex items-center gap-1">
              <span>X2:</span>
              <input type="number" id="param-x2" placeholder="100" class="xp-input">
            </label>
            
            <label class="flex items-center gap-1">
              <span>Y2:</span>
              <input type="number" id="param-y2" placeholder="100" class="xp-input">
            </label>
            
            <button id="draw-shape-btn" class="xp-button text-green-500 font-bold">
              Draw
            </button>
            
            <button id="close-params-btn" class="xp-button text-red-500 font-bold">
              Close
            </button>
          </div>
        </div>

        <!-- Edit Shape Panel -->
        <div id="edit-shape-panel" class="hidden bg-[#ECE9D8] border-t border-[#808080] px-2 py-2">
          <div class="flex items-center gap-2 text-xs flex-wrap">
            <span>Editing: <span id="edit-shape-type" class="font-bold text-blue-500">-</span></span>
            
            <label class="flex items-center gap-1">
              <span>X1:</span>
              <input type="number" id="edit-x1" placeholder="0" class="xp-input">
            </label>
            
            <label class="flex items-center gap-1">
              <span>Y1:</span>
              <input type="number" id="edit-y1" placeholder="0" class="xp-input">
            </label>
            
            <label class="flex items-center gap-1">
              <span>X2:</span>
              <input type="number" id="edit-x2" placeholder="100" class="xp-input">
            </label>
            
            <label class="flex items-center gap-1">
              <span>Y2:</span>
              <input type="number" id="edit-y2" placeholder="100" class="xp-input">
            </label>
            
            <button id="update-shape-btn" class="xp-button text-green-500 font-bold">
              <i class="fas fa-check mr-1"></i>Update Shape
            </button>
            
            <button id="close-edit-btn" class="xp-button text-red-500 font-bold">
              Close
            </button>
          </div>
        </div>

        <!-- Zoom Panel -->
        <div id="zoom-panel" class="hidden bg-[#ECE9D8] border-t border-[#808080] px-2 py-2">
          <div class="flex items-center gap-2 text-xs flex-wrap">

            <button id="zoom-in-btn" class="xp-button">+</button>
            <button id="zoom-out-btn" class="xp-button">--</button>
            <span id="zoom-value">100%</span>
            <button id="zoom-reset-btn" class="xp-button">Reset</button>

            <span class="ml-4 font-bold">|</span>

            <label class="flex ml-4 mr-2 items-center gap-1">
              Pixel Values:
              <span id="zoom-r-label" class="ml-2">R:
                <span id="zoom-r-value">0</span>
              </span>
              <span id="zoom-g-label" class="ml-2">G:
                <span id="zoom-g-value">0</span>
              </span>
              <span id="zoom-b-label" class="ml-2">B:
                <span id="zoom-b-value">0</span>
              </span>
            </label>
            
            <button id="close-zoom-btn" class="xp-button text-red-500 font-bold">
              Close
            </button>

          </div>
        </div>

        <!-- Color Picker Panel  -->
        <div id="color-picker-panel" class="hidden bg-[#ECE9D8] border-t border-[#808080] px-2 py-2">
          <div class="flex items-center gap-2 text-xs flex-wrap">
            
            <label class="flex items-center gap-1">
              <span>Choose Color:</span>
              <select id="color-style-select" class="xp-select">
                <option value="color-style-rgb">RGB</option>
                <option value="color-style-cmyk">CMYK</option>
              </select>

              <input type="checkbox" id="color-picker-checkbox" class="xp-checkbox ml-4">
              <span>Text</span>
            </label>

            <span class="font-bold ml-4">|</span>

            <label id="color-rgb-slider-label" class="hidden flex items-center gap-1 ml-4">
              <span>R:</span>
              <input type="range" id="color-r-slider" min="0" max="255" value="0" class="xp-slider w-24">
              <span id="color-r-slider-value" class="w-6 text-xs">0</span>

              <span>G:</span>
              <input type="range" id="color-g-slider" min="0" max="255" value="0" class="xp-slider w-24">
              <span id="color-g-slider-value" class="w-6 text-xs">0</span>

              <span>B:</span>
              <input type="range" id="color-b-slider" min="0" max="255" value="0" class="xp-slider w-24">
              <span id="color-b-slider-value" class="w-6 text-xs">0</span>
            </label>

            <label id="color-cmyk-slider-label" class="hidden flex items-center gap-1 ml-4">
              <span>C:</span>
              <input type="range" id="color-c-slider" min="0" max="255" value="0" class="xp-slider w-24">
              <span id="color-c-slider-value" class="w-6 text-xs">0</span>

              <span>M:</span>
              <input type="range" id="color-m-slider" min="0" max="255" value="0" class="xp-slider w-24">
              <span id="color-m-slider-value" class="w-6 text-xs">0</span>

              <span>Y:</span>
              <input type="range" id="color-y-slider" min="0" max="255" value="0" class="xp-slider w-24">
              <span id="color-y-slider-value" class="w-6 text-xs">0</span>
              
              <span>K:</span>
              <input type="range" id="color-k-slider" min="0" max="255" value="0" class="xp-slider w-24">
              <span id="color-k-slider-value" class="w-6 text-xs">0</span>
            </label>

            <label id="color-rgb-text-label" class="hidden flex items-center gap-1 ml-4">
              <span>R:</span>
              <input type="number" id="color-r-input" min="0" max="255" value="0" class="xp-input w-16">

              <span>G:</span>
              <input type="number" id="color-g-input" min="0" max="255" value="0" class="xp-input w-16">

              <span>B:</span>
              <input type="number" id="color-b-input" min="0" max="255" value="0" class="xp-input w-16">
            </label>

            <label id="color-cmyk-text-label" class="hidden items-center gap-1 ml-4">
              <span>C:</span>
              <input type="number" id="color-c-input" min="0" max="255" value="0" class="xp-input w-16">

              <span>M:</span>
              <input type="number" id="color-m-input" min="0" max="255" value="0" class="xp-input w-16">

              <span>Y:</span>
              <input type="number" id="color-y-input" min="0" max="255" value="0" class="xp-input w-16">

              <span>K:</span>
              <input type="number" id="color-k-input" min="0" max="255" value="0" class="xp-input w-16">
            </label>

            <div id="color-preview" class="inline-block w-16 h-7 border-2 border-[#404040]" style="background-color: #000000;"></div>

            <button id="close-color-picker-btn" class="xp-button text-red-500 font-bold ml-4">
              Close
            </button>
          </div>

        </div>

        <!-- Rotate Cube Panel -->
        <div id="rotate-cube-panel" class="hidden bg-[#ECE9D8] border-t border-[#808080] px-2 py-2">
          <div class="flex items-start gap-4 text-xs">
            
            <!-- Left side: Rotation controls -->
            <div class="flex flex-col gap-2">
              <span class="font-bold">Rotate Cube:</span>
              <label class="flex items-center gap-1">
                <span class="w-8">X:</span>
                <input type="range" id="rotate-x-slider" min="-180" max="180" value="0" class="xp-slider w-32">
                <span id="rotate-x-value" class="w-12 text-xs">0Â°</span>
              </label>
              <label class="flex items-center gap-1">
                <span class="w-8">Y:</span>
                <input type="range" id="rotate-y-slider" min="-180" max="180" value="0" class="xp-slider w-32">
                <span id="rotate-y-value" class="w-12 text-xs">0Â°</span>
              </label>
            </div>

            <span class="font-bold">|</span>

            <!-- Middle: Slice controls -->
            <div class="flex flex-col gap-2">
              <span class="font-bold">Cube Slice:</span>
              <label class="flex items-center gap-1">
                <span class="w-12">Axis:</span>
                <select id="slice-axis-select" class="xp-select">
                  <option value="x">Red (X)</option>
                  <option value="y">Green (Y)</option>
                  <option value="z" selected>Blue (Z)</option>
                </select>
              </label>
              <label class="flex items-center gap-1">
                <span class="w-12">Position:</span>
                <input type="range" id="slice-position-slider" min="0" max="100" value="50" class="xp-slider w-32">
                <span id="slice-position-value" class="w-12 text-xs">50%</span>
              </label>
            </div>

            <span class="font-bold">|</span>

            <!-- Right side: Slice preview -->
            <div class="flex flex-col gap-2 items-center">
              <span class="font-bold">Slice Preview:</span>
              <canvas id="slice-canvas" width="200" height="200" class="border-2 border-[#404040]"></canvas>
            </div>

            <button id="close-rotate-cube-btn" class="xp-button text-red-500 font-bold ml-4">Close</button>
          </div>
        </div>

        <!-- Image Processing Panel -->
        <div id="image-processing-panel" class="hidden bg-[#ECE9D8] border-t border-[#808080] px-2 py-2">
          <div class="flex flex-col gap-3 text-xs">
            
            <!-- Row 1: Add/Subtract operations -->
            <div class="flex items-center gap-2 flex-wrap">
              <span class="font-bold">Add/Subtract:</span>
              <label class="flex items-center gap-1">
                <span>R:</span>
                <input type="number" id="add-r" placeholder="0" min="-255" max="255" value="0" class="xp-input w-16">
              </label>
              <label class="flex items-center gap-1">
                <span>G:</span>
                <input type="number" id="add-g" placeholder="0" min="-255" max="255" value="0" class="xp-input w-16">
              </label>
              <label class="flex items-center gap-1">
                <span>B:</span>
                <input type="number" id="add-b" placeholder="0" min="-255" max="255" value="0" class="xp-input w-16">
              </label>
              <button id="btn-add" class="xp-button text-green-600">
                <i class="fas fa-plus mr-1"></i>Add
              </button>
              <button id="btn-subtract" class="xp-button text-orange-600">
                <i class="fas fa-minus mr-1"></i>Subtract
              </button>
            </div>

            <div class="border-t border-[#808080]"></div>

            <!-- Row 2: Multiply/Divide operations -->
            <div class="flex items-center gap-2 flex-wrap">
              <span class="font-bold">Multiply/Divide:</span>
              <label class="flex items-center gap-1">
                <span>R:</span>
                <input type="number" id="mult-r" placeholder="1.0" step="0.1" value="1.0" class="xp-input w-16">
              </label>
              <label class="flex items-center gap-1">
                <span>G:</span>
                <input type="number" id="mult-g" placeholder="1.0" step="0.1" value="1.0" class="xp-input w-16">
              </label>
              <label class="flex items-center gap-1">
                <span>B:</span>
                <input type="number" id="mult-b" placeholder="1.0" step="0.1" value="1.0" class="xp-input w-16">
              </label>
              <button id="btn-multiply" class="xp-button text-purple-600">
                <i class="fas fa-times mr-1"></i>Multiply
              </button>
              <button id="btn-divide" class="xp-button text-pink-600">
                <i class="fas fa-divide mr-1"></i>Divide
              </button>
            </div>

            <div class="border-t border-[#808080]"></div>

            <!-- Row 3: Brightness -->
            <div class="flex items-center gap-2 flex-wrap">
              <span class="font-bold">Brightness:</span>
              <label class="flex items-center gap-1">
                <span>Value:</span>
                <input type="range" id="brightness-slider" min="-255" max="255" value="0" class="xp-slider w-48">
                <span id="brightness-value" class="w-12">0</span>
              </label>
              <button id="btn-brightness" class="xp-button text-yellow-600">
                <i class="fas fa-sun mr-1"></i>Apply
              </button>
            </div>

            <div class="border-t border-[#808080]"></div>

            <!-- Row 4: Grayscale -->
            <div class="flex items-center gap-2 flex-wrap">
              <span class="font-bold">Grayscale:</span>
              <button id="btn-grayscale-avg" class="xp-button">
                Average
              </button>
              <button id="btn-grayscale-lum" class="xp-button">
                Luminance
              </button>
              <button id="btn-grayscale-des" class="xp-button">
                Desaturation
              </button>
            </div>

            <div class="border-t border-[#808080]"></div>

            <!-- Row 5: Filters -->
            <div class="flex items-center gap-2 flex-wrap">
              <span class="font-bold">Filters:</span>
              <button id="btn-smoothing-filter" class="xp-button text-indigo-600">
                <i class="fas fa-magic mr-1"></i>Smoothing
              </button>
              <button id="btn-median-filter" class="xp-button text-teal-600">
                <i class="fas fa-filter mr-1"></i>Median
              </button>
              <button id="btn-sobel-filter" class="xp-button text-cyan-600">
                <i class="fas fa-border-style mr-1"></i>Sobel Edge
              </button>
              <button id="btn-sharpen-filter" class="xp-button text-red-600">
                <i class="fas fa-adjust mr-1"></i>Sharpen
              </button>
              <button id="btn-gaussian-filter" class="xp-button text-blue-600">
                <i class="fas fa-cloud mr-1"></i>Gaussian Blur
              </button>
            </div>

            <div class="border-t border-[#808080]"></div>

            <!-- Row 6: Utility buttons -->
            <div class="flex items-center gap-2 flex-wrap">
              <button id="btn-reset-image" class="xp-button text-blue-600">
                <i class="fas fa-undo mr-1"></i>Reset to Original
              </button>
              <button id="close-image-processing-btn" class="xp-button text-red-500 font-bold">
                Close
              </button>
            </div>
          </div>
        </div>

        <!-- Histogram Panel -->
        <div id="histogram-panel" class="hidden bg-[#ECE9D8] border-t border-[#808080] px-2 py-2">
          <div class="flex flex-col gap-3 text-xs">
            
            <div class="flex items-center gap-2 flex-wrap">
              <span class="font-bold">Operations:</span>
              <button id="btn-stretch-histogram" class="xp-button text-lime-600">
                <i class="fas fa-arrows-alt-h mr-1"></i>Stretch Histogram
              </button>
              <button id="btn-equalize-histogram" class="xp-button text-green-600">
                <i class="fas fa-equals mr-1"></i>Equalize Histogram
              </button>
            </div>

            <div class="border-t border-[#808080]"></div>

            <div class="flex flex-col gap-2">
              <span class="font-bold">Histogram Visualization:</span>
              <div class="flex gap-4 items-start flex-wrap">
                <div class="flex flex-col gap-1">
                  <span class="text-xs font-bold text-red-600">Red Channel</span>
                  <canvas id="histogram-r" width="256" height="100" class="border border-[#808080] bg-white"></canvas>
                </div>
                <div class="flex flex-col gap-1">
                  <span class="text-xs font-bold text-green-600">Green Channel</span>
                  <canvas id="histogram-g" width="256" height="100" class="border border-[#808080] bg-white"></canvas>
                </div>
                <div class="flex flex-col gap-1">
                  <span class="text-xs font-bold text-blue-600">Blue Channel</span>
                  <canvas id="histogram-b" width="256" height="100" class="border border-[#808080] bg-white"></canvas>
                </div>
              </div>
            </div>

            <div class="border-t border-[#808080]"></div>

            <div class="flex flex-col gap-2">
              <span class="font-bold">Binarization:</span>
              
              <div class="flex items-center gap-2 flex-wrap">
                <span class="text-xs">Manual Threshold:</span>
                <label class="flex items-center gap-1">
                  <span>Threshold:</span>
                  <input type="range" id="binarize-threshold-slider" min="0" max="255" value="128" class="xp-slider w-48">
                  <span id="binarize-threshold-value" class="w-12">128</span>
                </label>
                <button id="btn-binarize-manual" class="xp-button text-purple-600">
                  <i class="fas fa-adjust mr-1"></i>Apply Manual
                </button>
              </div>

              <div class="flex items-center gap-2 flex-wrap">
                <span class="text-xs">Automatic Methods:</span>
                <label class="flex items-center gap-1">
                  <span>% Black:</span>
                  <input type="number" id="percent-black-input" min="0" max="100" value="50" step="1" class="xp-input w-16">
                </label>
                <button id="btn-binarize-percent" class="xp-button text-indigo-600">
                  <i class="fas fa-percentage mr-1"></i>Percent Black
                </button>
                <button id="btn-binarize-mean" class="xp-button text-teal-600">
                  <i class="fas fa-sync mr-1"></i>Mean Iterative
                </button>
              </div>
            </div>

            <div class="border-t border-[#808080]"></div>

            <div class="flex items-center gap-2 flex-wrap">
              <button id="btn-reset-histogram" class="xp-button text-blue-600">
                <i class="fas fa-undo mr-1"></i>Reset to Original
              </button>
              <button id="close-histogram-btn" class="xp-button text-red-500 font-bold">
                Close
              </button>
            </div>
          </div>
        </div>

        <!-- Morphological Filters Panel -->
        <div id="morphological-panel" class="hidden bg-[#ECE9D8] border-t border-[#808080] px-2 py-2">
          <div class="flex flex-col gap-3 text-xs">
            
            <!-- Section 1: Structuring Element Definition -->
            <div class="flex flex-col gap-2">
              <span class="font-bold">Structuring Element:</span>
              
              <div class="flex items-center gap-2 flex-wrap">
                <label class="flex items-center gap-1">
                  <span>Preset:</span>
                  <select id="morph-se-preset" class="xp-select">
                    <option value="square3">Square 3Ã—3</option>
                    <option value="square5">Square 5Ã—5</option>
                    <option value="cross3">Cross 3Ã—3</option>
                    <option value="cross5">Cross 5Ã—5</option>
                    <option value="diamond3">Diamond 3Ã—3</option>
                    <option value="diamond5">Diamond 5Ã—5</option>
                    <option value="custom">Custom...</option>
                  </select>
                </label>
              </div>

              <!-- Custom SE Input -->
              <div id="morph-custom-se-container" class="hidden flex flex-col gap-1">
                <label class="flex items-start gap-1">
                  <span class="whitespace-nowrap">Definition:</span>
                  <textarea id="morph-se-input" 
                    class="xp-input font-mono text-[10px]" 
                    rows="3" 
                    cols="20"
                    placeholder="1,1,1;1,1,1;1,1,1"
                    title="Format: rows separated by semicolon, values by comma. Size must be odd."></textarea>
                </label>
                <button id="btn-apply-custom-se" class="xp-button text-green-600 text-[10px]">
                  <i class="fas fa-check mr-1"></i>Apply Custom SE
                </button>
              </div>

              <!-- SE Preview -->
              <div class="flex items-start gap-2">
                <span class="whitespace-nowrap">SE Preview:</span>
                <div id="morph-se-preview" class="font-mono text-[10px] bg-white border border-[#808080] p-1 min-w-[60px]">
                  1 1 1<br>1 1 1<br>1 1 1
                </div>
              </div>
            </div>

            <div class="border-t border-[#808080]"></div>

            <!-- Section 2: Basic Filters -->
            <div class="flex flex-col gap-2">
              <span class="font-bold">Basic Morphological Filters:</span>
              
              <p class="text-[10px] text-gray-500">
                Image will be automatically binarized before applying filters.
              </p>

              <div class="flex items-center gap-2 flex-wrap">
                <button id="btn-morph-dilate" class="xp-button">
                  <i class="fas fa-expand-arrows-alt mr-1"></i>Dilation
                </button>
                <button id="btn-morph-erode" class="xp-button">
                  <i class="fas fa-compress-arrows-alt mr-1"></i>Erosion
                </button>
                <button id="btn-morph-open" class="xp-button">
                  <i class="fas fa-door-open mr-1"></i>Opening
                </button>
                <button id="btn-morph-close" class="xp-button">
                  <i class="fas fa-door-closed mr-1"></i>Closing
                </button>
              </div>
            </div>

            <div class="border-t border-[#808080]"></div>

            <!-- Section 3: Hit-or-Miss Operations -->
            <div class="flex flex-col gap-2">
              <span class="font-bold">Hit-or-Miss Operations:</span>
              
              <div class="flex items-center gap-2 flex-wrap">
                <label class="flex items-center gap-1">
                  <span>Iterations:</span>
                  <input type="number" id="morph-iterations" class="xp-input w-16" value="1" min="1" max="100" title="Number of iterations (1-100)">
                </label>
              </div>

              <div class="flex items-center gap-2 flex-wrap">
                <button id="btn-morph-thin" class="xp-button">
                  <i class="fas fa-compress mr-1"></i>Thinning
                </button>
                <button id="btn-morph-thicken" class="xp-button">
                  <i class="fas fa-expand mr-1"></i>Thickening
                </button>
              </div>
              
              <p class="text-[10px] text-gray-600 italic">
                Note: Hit-or-Miss operations work on binary images. Set iterations to 0 for full convergence.
              </p>
            </div>

            <div class="border-t border-[#808080]"></div>

            <!-- Section 4: Actions -->
            <div class="flex items-center gap-2 flex-wrap">
              <button id="btn-morph-reset" class="xp-button text-blue-600">
                <i class="fas fa-undo mr-1"></i>Reset to Original
              </button>
              <button id="close-morphological-btn" class="xp-button text-red-500 font-bold">
                Close
              </button>
            </div>

          </div>
        </div>

        <!-- Green Area Analysis Panel -->
        <div id="green-analysis-panel" class="hidden bg-[#ECE9D8] border-t border-[#808080] px-2 py-2">
          <div class="flex flex-col gap-3 text-xs">
            
            <!-- Section 1: Color Preset Selection -->
            <div class="flex flex-col gap-2">
              <span class="font-bold">Color Area Analysis (HSV Color Space)</span>
              <p class="text-gray-600 italic text-[10px]">
                Detects color areas using HSV color space. Select a preset or define custom thresholds.
              </p>
              
              <div class="flex items-center gap-2 flex-wrap">
                <label class="flex items-center gap-1">
                  <span>Color Preset:</span>
                  <select id="color-preset-select" class="xp-select">
                    <option value="green">Green</option>
                    <option value="blue">Blue</option>
                    <option value="red">Red</option>
                    <option value="yellow">Yellow</option>
                    <option value="brown">Brown</option>
                    <option value="white">White</option>
                    <option value="black">Black</option>
                  </select>
                </label>
                <div id="color-preview-box" class="w-8 h-6 border-2 border-[#404040]" style="background-color: rgb(0, 255, 0);"></div>
              </div>
            </div>

            <div class="border-t border-[#808080]"></div>

            <!-- Section 2: Detection Thresholds -->
            <div class="flex flex-col gap-2">
              <span class="font-bold">Detection Thresholds (HSV):</span>
              
              <div class="flex items-center gap-2 flex-wrap">
                <label class="flex items-center gap-1">
                  <span>Hue Min:</span>
                  <input type="number" id="green-hue-min" min="0" max="360" value="60" class="xp-input w-16">
                </label>
                <label class="flex items-center gap-1">
                  <span>Hue Max:</span>
                  <input type="number" id="green-hue-max" min="0" max="360" value="180" class="xp-input w-16">
                </label>
                <label class="flex items-center gap-1">
                  <span>Sat Min:</span>
                  <input type="number" id="green-sat-min" min="0" max="255" value="25" class="xp-input w-16">
                </label>
                <label class="flex items-center gap-1">
                  <span>Sat Max:</span>
                  <input type="number" id="green-sat-max" min="0" max="255" value="255" class="xp-input w-16">
                </label>
              </div>
              <p class="text-[10px] text-gray-500">
                Hue: 0Â°=Red, 60Â°=Yellow, 120Â°=Green, 180Â°=Cyan, 240Â°=Blue, 300Â°=Magenta
              </p>
            </div>

            <div class="border-t border-[#808080]"></div>

            <!-- Section 3: Results -->
            <div class="flex flex-col gap-2">
              <span class="font-bold">Results:</span>
              
              <div class="flex items-start gap-4 flex-wrap">
                <!-- Stats -->
                <div class="flex flex-col gap-1 min-w-[200px]">
                  <div class="flex items-center gap-2">
                    <span>Detected Area:</span>
                    <span id="green-percentage" class="font-bold text-lg" style="color: rgb(0, 255, 0);">--%</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <span>Matched Pixels:</span>
                    <span id="green-pixel-count" style="color: rgb(0, 255, 0);">--</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <span>Total Pixels:</span>
                    <span id="total-pixel-count" class="text-gray-600">--</span>
                  </div>
                </div>

                <!-- Visual Indicator -->
                <div class="flex flex-col gap-1">
                  <span>Coverage:</span>
                  <div class="w-48 h-6 bg-gray-300 border border-[#808080] relative">
                    <div id="green-coverage-bar" class="h-full transition-all duration-300" style="width: 0%; background-color: rgb(0, 255, 0);"></div>
                    <span id="green-coverage-label" class="absolute inset-0 flex items-center justify-center text-xs font-bold">--%</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="border-t border-[#808080]"></div>

            <!-- Section 4: Actions -->
            <div class="flex items-center gap-2 flex-wrap">
              <button id="btn-analyze-green" class="xp-button text-green-600 font-bold">
                <i class="fas fa-search mr-1"></i>Analyze Color
              </button>
              <button id="btn-show-green-mask" class="xp-button text-blue-600">
                <i class="fas fa-eye mr-1"></i>Show Detection Mask
              </button>
              <button id="btn-green-reset" class="xp-button text-orange-600">
                <i class="fas fa-undo mr-1"></i>Reset to Original
              </button>
              <button id="close-green-analysis-btn" class="xp-button text-red-500 font-bold">
                Close
              </button>
            </div>

          </div>
        </div>

        <!-- Polygon Panel -->
        <div id="polygon-panel" class="hidden bg-[#ECE9D8] border-t border-[#808080] px-2 py-2">
          <div class="flex flex-col gap-3 text-xs">
            
            <!-- Section 1: Create New Polygon -->
            <div id="polygon-create-section" class="flex flex-col gap-2">
              <span class="font-bold">Create New Polygon:</span>
              
              <div class="flex items-center gap-2 flex-wrap">
                <label class="flex items-center gap-1">
                  <input type="checkbox" id="polygon-filled-checkbox" class="xp-checkbox">
                  <span>Filled</span>
                </label>
                
                <label class="flex items-center gap-1 ml-4">
                  <span>X:</span>
                  <input type="number" id="polygon-point-x" value="100" class="xp-input w-20">
                </label>
                
                <label class="flex items-center gap-1">
                  <span>Y:</span>
                  <input type="number" id="polygon-point-y" value="100" class="xp-input w-20">
                </label>
                
                <button id="btn-add-polygon-vertex" class="xp-button text-green-600">
                  <i class="fas fa-plus mr-1"></i>Add Vertex
                </button>
                
                <button id="btn-remove-last-vertex" class="xp-button text-orange-600">
                  <i class="fas fa-undo mr-1"></i>Remove Last
                </button>
                
                <button id="btn-finish-polygon" class="xp-button text-blue-600 font-bold ml-4">
                  <i class="fas fa-check mr-1"></i>Finish Polygon
                </button>
              </div>
              
              <div id="polygon-preview-vertices" class="text-xs text-gray-600 italic">
                Vertices: <span id="polygon-vertex-count">0</span> (minimum 3 required) | ðŸ’¡ Press Backspace to remove last vertex
              </div>
            </div>

            <div class="border-t border-[#808080]"></div>
            
            <!-- Section 2: Edit Existing Polygon -->
            <div id="polygon-edit-section" class="hidden flex flex-col gap-2">
              <div class="flex items-center gap-2 flex-wrap">
                <span class="font-bold">Polygon Vertices:</span>
                <span id="polygon-vertices-count" class="text-blue-600">0 vertices</span>
                <label class="flex items-center gap-1 ml-4">
                  <input type="checkbox" id="polygon-edit-filled" class="xp-checkbox">
                  <span>Filled</span>
                </label>
              </div>
            </div>

            <div class="border-t border-[#808080]"></div>

            <!-- Section 3: Transformations -->
            <div id="polygon-transform-section" class="hidden flex flex-col gap-2">
              <span class="font-bold">Transformations (Homogeneous Coordinates):</span>
              
              <div class="flex items-center gap-2 flex-wrap">
                <span class="text-xs font-bold">Translation:</span>
                <label class="flex items-center gap-1">
                  <span>Î”x:</span>
                  <input type="number" id="polygon-translate-dx" value="0" class="xp-input w-20">
                </label>
                <label class="flex items-center gap-1">
                  <span>Î”y:</span>
                  <input type="number" id="polygon-translate-dy" value="0" class="xp-input w-20">
                </label>
                <button id="btn-polygon-translate" class="xp-button text-purple-600">
                  <i class="fas fa-arrows-alt mr-1"></i>Apply Translation
                </button>
              </div>

              <div class="border-t border-[#808080] my-1"></div>

              <div class="flex flex-col gap-2">
                <div class="flex items-center gap-2 flex-wrap">
                  <span class="text-xs font-bold">Rotation Pivot:</span>
                  <label class="flex items-center gap-1">
                    <span>Pivot X:</span>
                    <input type="number" id="polygon-pivot-x" value="0" class="xp-input w-20">
                  </label>
                  <label class="flex items-center gap-1">
                    <span>Pivot Y:</span>
                    <input type="number" id="polygon-pivot-y" value="0" class="xp-input w-20">
                  </label>
                  <button id="btn-apply-pivot" class="xp-button text-blue-600">
                    <i class="fas fa-check mr-1"></i>Set Pivot
                  </button>
                </div>

                <div class="flex items-center gap-2 flex-wrap">
                  <span class="text-xs font-bold">Rotation Angle:</span>
                  <label class="flex items-center gap-1">
                    <span>Angle (degrees):</span>
                    <input type="number" id="polygon-rotate-angle" value="0" step="1" class="xp-input w-20">
                  </label>
                  <button id="btn-polygon-rotate" class="xp-button text-orange-600">
                    <i class="fas fa-sync-alt mr-1"></i>Apply Rotation
                  </button>
                </div>

                <div class="text-xs text-gray-600 italic">
                  ðŸ’¡ Current pivot: <span id="polygon-pivot-display" class="font-bold text-blue-600">Not set</span> | Hold <span class="font-bold">Ctrl+Drag</span> to rotate with mouse
                </div>
              </div>

              <div class="border-t border-[#808080] my-1"></div>

              <div class="flex flex-col gap-2">
                <div class="flex items-center gap-2 flex-wrap">
                  <span class="text-xs font-bold">Scale Point:</span>
                  <label class="flex items-center gap-1">
                    <span>Point X:</span>
                    <input type="number" id="polygon-scale-point-x" value="0" class="xp-input w-20">
                  </label>
                  <label class="flex items-center gap-1">
                    <span>Point Y:</span>
                    <input type="number" id="polygon-scale-point-y" value="0" class="xp-input w-20">
                  </label>
                  <button id="btn-apply-scale-point" class="xp-button text-green-600">
                    <i class="fas fa-check mr-1"></i>Set Scale Point
                  </button>
                </div>

                <div class="flex items-center gap-2 flex-wrap">
                  <span class="text-xs font-bold">Scale Factors:</span>
                  <label class="flex items-center gap-1">
                    <span>Sx:</span>
                    <input type="number" id="polygon-scale-sx" value="1" step="0.1" class="xp-input w-20">
                  </label>
                  <label class="flex items-center gap-1">
                    <span>Sy:</span>
                    <input type="number" id="polygon-scale-sy" value="1" step="0.1" class="xp-input w-20">
                  </label>
                  <button id="btn-polygon-scale" class="xp-button text-teal-600">
                    <i class="fas fa-expand-arrows-alt mr-1"></i>Apply Scaling
                  </button>
                </div>

                <div class="text-xs text-gray-600 italic">
                  ðŸ’¡ Current scale point: <span id="polygon-scale-point-display" class="font-bold text-green-600">Not set</span> | Hold <span class="font-bold">Alt+Drag</span> to scale with mouse
                </div>
              </div>
            </div>

            <div class="border-t border-[#808080]"></div>

            <div class="flex items-center gap-2 flex-wrap">
              <button id="close-polygon-btn" class="xp-button text-red-500 font-bold">
                Close
              </button>
            </div>
          </div>
        </div>

        <!-- Bezier Panel -->
        <div id="bezier-panel" class="hidden bg-[#ECE9D8] border-t border-[#808080] px-2 py-2">
          <div class="flex flex-col gap-3 text-xs">
            
            <!-- Section 1: Create New Curve -->
            <div id="bezier-create-section" class="flex flex-col gap-2">
              <span class="font-bold">Create New BÃ©zier Curve:</span>
              
              <div class="flex items-center gap-2 flex-wrap">
                <label class="flex items-center gap-1">
                  <span>Degree:</span>
                  <input type="number" id="bezier-degree-input" min="1" max="20" value="3" class="xp-input w-16">
                </label>
                
                <label class="flex items-center gap-1 ml-4">
                  <span>Start Point - X:</span>
                  <input type="number" id="bezier-start-x" value="100" class="xp-input w-20">
                </label>
                
                <label class="flex items-center gap-1">
                  <span>Y:</span>
                  <input type="number" id="bezier-start-y" value="100" class="xp-input w-20">
                </label>
                
                <button id="btn-create-bezier" class="xp-button text-blue-600 font-bold ml-4">
                  <i class="fas fa-magic mr-1"></i>Create Curve
                </button>
              </div>
              
              <span class="text-xs text-gray-600 italic">ðŸ’¡ Degree determines curve complexity. Points will be created horizontally from the start point.</span>
            </div>

            <div class="border-t border-[#808080]"></div>
            
            <!-- Section 2: Edit Existing Curve -->
            <div id="bezier-edit-section" class="hidden flex flex-col gap-2">
              <div class="flex items-center gap-2 flex-wrap">
                <span class="font-bold">Bezier Curve Control Points:</span>
                <span id="bezier-point-count" class="text-blue-600">0 points</span>
                <span class="ml-4 font-bold">Degree:</span>
                <span id="bezier-degree" class="text-green-600">-</span>
              </div>

              <div class="border-t border-[#808080]"></div>

              <div id="bezier-points-container" class="flex flex-col gap-2 max-h-48 overflow-y-auto">
                <!-- Control points will be added here dynamically -->
              </div>

              <div class="border-t border-[#808080]"></div>

              <div class="flex items-center gap-2 flex-wrap">
                <button id="btn-add-bezier-point" class="xp-button text-green-600">
                  <i class="fas fa-plus mr-1"></i>Add Point (at end)
                </button>
                <button id="btn-remove-selected-point" class="xp-button text-red-600">
                  <i class="fas fa-trash mr-1"></i>Remove Selected Point
                </button>
              </div>
            </div>

            <div class="border-t border-[#808080]"></div>

            <div class="flex items-center gap-2 flex-wrap">
              <button id="close-bezier-btn" class="xp-button text-red-500 font-bold">
                Close
              </button>
            </div>
          </div>
        </div>

      </div>

    </base-window>
    
    <!-- Modal Component -->
    <modal-window></modal-window>

    <!-- Logic -->
    <script type="module" src="../src/projects/project.ts"></script>
  </body>
</html>